<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Editor de niveles - Yalmil Mario Style</title>

  <link rel="icon" href="https://cdn.discordapp.com/emojis/1416607460201857168.png?v=1" type="image/png">
  <meta property="og:title" content="Yalmil.com" />
  <meta property="og:description" content="Editor de niveles estilo Mario con exportación .ymlvl" />
  <meta property="og:image" content="https://cdn.discordapp.com/attachments/1355008732576088204/1402309070014124102/Screenshot_20250804-221210.png?ex=68937197&is=68922017&hm=1fa6f462304b2b8cf8a0875053730f988d725d114fbf2648fcb87ee1b67b6a76&" />
  <meta property="og:url" content="https://yalmil.github.io/Yalmil.com/" />
  <meta property="og:type" content="website" />

  <style>
    body {
      background: linear-gradient(#8ed0ff, #7ac8ff);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      color: #222;
      text-align: center;
    }

    h1 {
      background: #ffcc00;
      padding: 10px;
      margin: 0;
      color: #222;
    }

    #editor {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px;
      gap: 20px;
      flex-wrap: wrap;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(20, 32px);
      grid-auto-rows: 32px;
      gap: 1px;
      background: #9bd0ff;
      border: 3px solid #000;
      border-radius: 10px;
      padding: 5px;
    }

    .cell {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .toolbar {
      background: #fff3c4;
      border: 2px solid #000;
      border-radius: 10px;
      padding: 10px;
      width: 220px;
    }

    .toolbar h3 {
      margin-top: 0;
    }

    .btn {
      background: #ffcc00;
      border: 2px solid #000;
      border-radius: 6px;
      padding: 5px 10px;
      cursor: pointer;
      font-weight: bold;
      margin: 3px;
    }

    .btn:hover {
      background: #ffe680;
    }

    .selected {
      outline: 3px solid #000;
    }

    #info {
      font-size: 14px;
      margin-top: 8px;
    }
  </style>
</head>
<body>

  <h1>Editor de niveles estilo Mario - Yalmil</h1>

  <div id="editor">
    <div class="toolbar">
      <h3>Paleta</h3>
      <div id="palette"></div>

      <hr>
      <button class="btn" id="setStart">Colocar inicio</button>
      <button class="btn" id="toggleErase">Modo borrar</button>
      <hr>
      <input type="text" id="levelName" placeholder="Nombre del nivel" style="width:100%;margin-bottom:5px;">
      <input type="text" id="textureLink" placeholder="Link textura" style="width:100%;">
      <hr>
      <button class="btn" id="export">Exportar .ymlvl</button>
      <button class="btn" id="clear">Limpiar</button>
      <div id="info"></div>
    </div>

    <div id="grid"></div>
  </div>

  <script>
    const paletteItems = [
      { type: 'block', id: 1, name: 'Bloque (ID 1)', color: '#7b5e32' },
      { type: 'block', id: 2, name: 'Pared (ID 2)', color: '#a66b3f' },
      { type: 'block', id: 3, name: 'Interactable (ID 3)', color: '#4caf50' },
      { type: 'block', id: 4, name: 'Decoración (ID 4)', color: 'rgba(255,255,255,0.6)' },
      { type: 'enemy', id: 1, name: 'Básico (ID 1)', color: '#ff7777' },
      { type: 'enemy', id: 2, name: 'Normal (ID 2)', color: '#ff9999' },
      { type: 'enemy', id: 3, name: 'Épico (ID 3)', color: '#ff4444' },
      { type: 'enemy', id: 4, name: 'Laiva (ID 4)', color: '#aa00ff' },
      { type: 'enemy', id: 5, name: 'Lanzable (ID 5)', color: '#ffaa00' }
    ];

    const grid = document.getElementById('grid');
    const palette = document.getElementById('palette');
    const info = document.getElementById('info');

    let selected = { type: 'block', id: 1 };
    let eraseMode = false;
    let playerStart = null;
    const gridData = Array.from({ length: 12 }, () => Array(20).fill(null));

    // Crear paleta
    paletteItems.forEach(item => {
      const div = document.createElement('div');
      div.className = 'cell';
      div.style.background = item.color;
      div.title = item.name;
      div.textContent = item.type === 'enemy' ? 'E' + item.id : item.id;
      div.onclick = () => {
        selected = item;
        eraseMode = false;
        document.querySelectorAll('#palette .cell').forEach(c => c.classList.remove('selected'));
        div.classList.add('selected');
        info.textContent = `Modo: ${item.name}`;
      };
      palette.appendChild(div);
    });
    palette.firstChild.classList.add('selected');

    // Crear grilla
    function renderGrid() {
      grid.innerHTML = '';
      gridData.forEach((row, y) => {
        row.forEach((cell, x) => {
          const div = document.createElement('div');
          div.className = 'cell';
          if (cell) {
            div.style.background = cell.color;
            div.textContent = cell.type === 'enemy' ? 'E' + cell.id : (cell.type === 'start' ? 'S' : cell.id);
          }
          div.onclick = () => {
            if (eraseMode) {
              gridData[y][x] = null;
            } else if (selected.type === 'start') {
              if (playerStart) gridData[playerStart.y][playerStart.x] = null;
              playerStart = { x, y };
              gridData[y][x] = { type: 'start', id: 'S', color: '#ffd27f' };
            } else {
              gridData[y][x] = { ...selected };
            }
            renderGrid();
          };
          grid.appendChild(div);
        });
      });
    }

    renderGrid();

    document.getElementById('setStart').onclick = () => {
      selected = { type: 'start', id: 'S', name: 'Inicio', color: '#ffd27f' };
      eraseMode = false;
      document.querySelectorAll('#palette .cell').forEach(c => c.classList.remove('selected'));
      info.textContent = 'Modo: Inicio del jugador';
    };

    document.getElementById('toggleErase').onclick = () => {
      eraseMode = !eraseMode;
      info.textContent = eraseMode ? 'Modo borrar' : `Modo: ${selected.name}`;
    };

    document.getElementById('clear').onclick = () => {
      if (confirm('¿Seguro que quieres limpiar el nivel?')) {
        for (let y = 0; y < gridData.length; y++) {
          for (let x = 0; x < gridData[y].length; x++) gridData[y][x] = null;
        }
        playerStart = null;
        renderGrid();
      }
    };

    document.getElementById('export').onclick = () => {
      const name = document.getElementById('levelName').value || 'Nivel';
      const texture = document.getElementById('textureLink').value || '';
      const lines = [];

      lines.push('/- Estructura base -\\');
      lines.push(':Comentar contenido: /- isopus -\\');

      gridData.forEach((row, y) => {
        row.forEach((cell, x) => {
          if (cell && cell.type === 'block')
            lines.push(`:Posición de un bloque: #tob-${cell.id}-${y}-${x}#`);
          if (cell && cell.type === 'enemy')
            lines.push(`:Enemigos: #enemy=${cell.id}-${y}-${x}#`);
        });
      });

      if (texture) lines.push(`:Asignación de texturas: #tfb=${texture}#`);
      if (playerStart) lines.push(`:Inicio del jugador: #initial=${playerStart.y}-${playerStart.x}#`);

      lines.push('');
      lines.push('/- Tipos de enemigos -\\');
      lines.push(':Básico: Solo puede caminar en línea recta, su ID es 1');
      lines.push(':Normal: Igual que básico pero puede saltar hasta un bloque, su ID es 2');
      lines.push(':Epico: Puede hacer lo mismo que los anteriores añadiendo que ahora puede lanzar el enemigo con ID 5, su ID es 3');
      lines.push(':Laiva: Solo puede ir de arriba a abajo no tiene colisión con bloques y hace instakill, su ID es 4');
      lines.push(':Lanzable: Este enemigo puede ser lanzado por ID 3 y no tiene gravedad solo puede ir hacia el lado donde fue lanzado, su ID es 5');

      lines.push('');
      lines.push('/- Tipos de bloques -\\');
      lines.push(':Normal: No se puede romper y es usado para el piso normalment, su ID es 1');
      lines.push(':Pared: Es parecido al ID 1 pero este se puede romper, su ID es 2');
      lines.push(':Interactable: Se puede usar para ejecutar eventos básicos como pasar de nivel o matar a algún enemigo, su ID es 3');
      lines.push(':Decoración: Se usa para decorar y no tiene colisión con ningún enemigo ni jugador');

      const blob = new Blob([lines.join('\\n')], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name}.ymlvl`;
      a.click();
    };
  </script>
</body>
  </html>
