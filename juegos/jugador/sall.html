<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sobrevive a las Letras</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: white;
      transition: background 2s;
    }

    #menu, #gameOver {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.85);
      z-index: 20;
      text-align: center;
      transition: opacity 0.5s;
    }

    #menu.hidden, #gameOver.hidden {
      opacity: 0;
      pointer-events: none;
    }

    button {
      background: #c084fc;
      border: none;
      color: white;
      padding: 12px 25px;
      margin: 10px;
      font-size: 1.2em;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
    }

    button:hover {
      background: #a855f7;
      transform: scale(1.05);
    }

    #ui {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 1.1em;
      color: #c084fc;
      z-index: 10;
      box-shadow: 0 0 10px #c084fc;
      display: none;
    }

    #game {
      display: block;
    }

    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>üÖ∞ Sobrevive a las Letras</h1>
    <button id="startBtn">Jugar</button>
    <button id="controlsBtn">Controles</button>
    <p id="controlsText" style="display:none; color:#ccc;">Mueve el mouse o toca la pantalla para esquivar las letras. Recoge los c√≠rculos para obtener habilidades.</p>
  </div>

  <div id="ui">
    üïí Tiempo: <span id="time">0</span>s |
    üíØ Puntos: <span id="score">0</span> |
    üèÜ R√©cord: <span id="record">0</span>s
  </div>

  <div id="gameOver" class="hidden">
    <h2 id="gameOverText">üíÄ Has perdido</h2>
    <button onclick="restartGame()">Reintentar</button>
    <button onclick="showMenu()">Men√∫</button>
  </div>

  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = innerWidth;
    canvas.height = innerHeight;

    const ui = document.getElementById("ui");
    const menu = document.getElementById("menu");
    const gameOverScreen = document.getElementById("gameOver");
    const recordDisplay = document.getElementById("record");
    const startBtn = document.getElementById("startBtn");
    const controlsBtn = document.getElementById("controlsBtn");

    let player, enemies, powerUps, mouse, timeSurvived, score, record, invulnerable, lastEnemySpawn, lastPowerUp, bgHue, gameLoopId, timerInterval;

    const letters = "√ëXYZWKLMNOPQRSTUVABCDE".split("");
    const enemyColors = ["#ff0044", "#ffcc00", "#00ffff", "#00ff66", "#cc00ff", "#ffaa00"];
    const powerUpColors = ["#00ffcc", "#ff00ff", "#00ff00", "#ffff00"];
    const bgColors = ["#0f0c29", "#302b63", "#24243e", "#1a1a1a"];

    record = parseInt(localStorage.getItem("record")) || 0;
    recordDisplay.textContent = record;

    function startGame() {
      menu.classList.add("hidden");
      ui.style.display = "block";
      gameOverScreen.classList.add("hidden");
      init();
    }

    function init() {
      player = { x: canvas.width / 2, y: canvas.height / 2, size: 20, speed: 0.2 };
      enemies = [];
      powerUps = [];
      mouse = { x: player.x, y: player.y };
      timeSurvived = 0;
      score = 0;
      invulnerable = false;
      lastEnemySpawn = 0;
      lastPowerUp = 0;
      bgHue = 0;

      clearInterval(timerInterval);
      cancelAnimationFrame(gameLoopId);

      timerInterval = setInterval(() => {
        timeSurvived++;
        document.getElementById("time").textContent = timeSurvived;
        if (timeSurvived % 10 === 0) changeBackground();
      }, 1000);

      gameLoop(performance.now());
    }

    function spawnEnemy() {
      const angle = Math.random() * Math.PI * 2;
      const radius = Math.max(canvas.width, canvas.height);
      const x = player.x + radius * Math.cos(angle);
      const y = player.y + radius * Math.sin(angle);
      const letter = letters[Math.floor(Math.random() * letters.length)];
      const color = enemyColors[Math.floor(Math.random() * enemyColors.length)];
      const speed = 1.4 + Math.random() * 1.2 + timeSurvived * 0.02;
      const type = Math.random() < 0.2 ? "zigzag" : "normal";
      enemies.push({ x, y, size: 30, speed, letter, color, type, angle: 0 });
    }

    function spawnPowerUp() {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      const type = ["shield", "speed", "wave", "magnet"][Math.floor(Math.random() * 4)];
      const color = powerUpColors[Math.floor(Math.random() * powerUpColors.length)];
      powerUps.push({ x, y, size: 15, time: Date.now(), type, color });
    }

    function drawPlayer() {
      const gradient = ctx.createRadialGradient(player.x, player.y, 5, player.x, player.y, 30);
      gradient.addColorStop(0, "#F5A927");
      gradient.addColorStop(1, "#F5A928");
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
      ctx.fill();

      if (invulnerable) {
        ctx.strokeStyle = "#00ffff";
        ctx.lineWidth = 4;
        ctx.stroke();
      }
    }

    function drawEnemies() {
      ctx.font = "bold 30px 'Courier New'";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      enemies.forEach(e => {
        ctx.fillStyle = e.color;
        ctx.shadowColor = e.color;
        ctx.shadowBlur = 15;
        ctx.fillText(e.letter, e.x, e.y);
        ctx.shadowBlur = 0;
      });
    }

    function updateEnemies() {
      enemies.forEach(e => {
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);
        if (e.type === "zigzag") e.angle += 0.2;
        e.x += (dx / dist) * e.speed + (e.type === "zigzag" ? Math.sin(e.angle) * 2 : 0);
        e.y += (dy / dist) * e.speed;
      });
    }

    function drawPowerUps() {
      powerUps.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function updatePlayer() {
      player.x += (mouse.x - player.x) * player.speed;
      player.y += (mouse.y - player.y) * player.speed;
    }

    function checkCollisions() {
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dist = Math.hypot(player.x - e.x, player.y - e.y);
        if (dist < player.size + e.size / 2 && !invulnerable) {
          gameOver();
          return;
        }
      }

      for (let i = powerUps.length - 1; i >= 0; i--) {
        const p = powerUps[i];
        const dist = Math.hypot(player.x - p.x, player.y - p.y);
        if (dist < player.size + p.size) {
          activatePowerUp(p.type);
          powerUps.splice(i, 1);
          score += 10;
          document.getElementById("score").textContent = score;
        }
      }
    }

    function activatePowerUp(type) {
      if (type === "shield") {
        invulnerable = true;
        setTimeout(() => invulnerable = false, 5000);
      } else if (type === "speed") {
        player.speed = 0.4;
        setTimeout(() => player.speed = 0.2, 5000);
      } else if (type === "wave") {
        enemies.splice(0, enemies.length);
      } else if (type === "magnet") {
        powerUps.forEach(p => {
          p.x = player.x;
          p.y = player.y;
        });
      }
    }

    function changeBackground() {
      bgHue = (bgHue + 1) % bgColors.length;
      document.body.style.background = bgColors[bgHue];
    }

    function gameOver() {
      cancelAnimationFrame(gameLoopId);
      clearInterval(timerInterval);
      ui.style.display = "none";
      gameOverScreen.classList.remove("hidden");

      const text = document.getElementById("gameOverText");
      if (timeSurvived > record) {
        localStorage.setItem("record", timeSurvived);
        text.textContent = `üéâ ¬°Nuevo r√©cord! Sobreviviste ${timeSurvived}s`;
      } else {
        text.textContent = `üíÄ Has perdido. Sobreviviste ${timeSurvived}s`;
      }
    }

    function restartGame() {
      gameOverScreen.classList.add("hidden");
      startGame();
    }

    function showMenu() {
      gameOverScreen.classList.add("hidden");
      menu.classList.remove("hidden");
    }

    function gameLoop(timestamp) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      updatePlayer();
      drawPlayer();

      drawEnemies();
      updateEnemies();

      drawPowerUps();
      checkCollisions();

      if (timestamp - lastEnemySpawn > 2000) {
        spawnEnemy();
        lastEnemySpawn = timestamp;
      }

      if (timestamp - lastPowerUp > 8000) {
        spawnPowerUp();
        lastPowerUp = timestamp;
      }

      gameLoopId = requestAnimationFrame(gameLoop);
    }

    window.addEventListener("mousemove", e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    window.addEventListener("touchmove", e => {
      const t = e.touches[0];
      mouse.x = t.clientX;
      mouse.y = t.clientY;
    });

    window.addEventListener("resize", () => {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    });

    controlsBtn.addEventListener("click", () => {
      const c = document.getElementById("controlsText");
      c.style.display = c.style.display === "none" ? "block" : "none";
    });

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
