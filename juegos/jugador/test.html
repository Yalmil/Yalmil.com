<!DOCTYPE html>
<html lang="es">
<head>

<!-- SEO -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yalmil.com</title>

<link rel="icon" href="https://cdn.discordapp.com/emojis/1416607460201857168.png?v=1">
<link rel="canonical" href="https://yalmil.pages.dev">

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
*{margin:0;box-sizing:border-box}

body{
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#0a0a0a,#1a001f);
  color:#e5ccff;
  overflow:hidden;
}

#menu{
  padding:20px;
}

.level{
  border:2px solid #c084fc;
  padding:10px;
  margin:10px 0;
  cursor:pointer;
  background:rgba(40,0,60,.25);
}

#hud{
  position:fixed;
  top:10px;
  left:10px;
  font-size:18px;
}

#game{
  display:none;
  position:fixed;
  inset:0;
}

.lane{
  position:absolute;
  width:25%;
  height:100%;
  border:1px solid #c084fc;
}

.hit{
  position:absolute;
  bottom:120px;
  width:100%;
  height:6px;
  background:#c084fc;
}

.note{
  position:absolute;
  width:60%;
  height:30px;
  background:#c084fc;
  left:20%;
  border-radius:6px;
}
</style>
</head>

<body>

<div id="menu">
  <h2>Niveles</h2>

  <div class="level"
       data-music="music.m4a"
       data-bpm="100"
       data-name="Tutorial">
    Tutorial
  </div>

  <div class="level"
       data-music="music/normal.mp3"
       data-bpm="140"
       data-name="Normal">
    Normal – BPM 140
  </div>

  <div class="level"
       data-music="music/hard.mp3"
       data-bpm="180"
       data-name="Difícil">
    Difícil – BPM 180
  </div>
</div>

<div id="hud" style="display:none">
  Score: <span id="score">0</span>
</div>

<div id="game">
  <div class="lane" data-key="a" style="left:0%">
    <div class="hit"></div>
  </div>
  <div class="lane" data-key="s" style="left:25%">
    <div class="hit"></div>
  </div>
  <div class="lane" data-key="w" style="left:50%">
    <div class="hit"></div>
  </div>
  <div class="lane" data-key="d" style="left:75%">
    <div class="hit"></div>
  </div>
</div>

<script>
const menu = document.getElementById("menu");
const game = document.getElementById("game");
const hud = document.getElementById("hud");
const lanes = document.querySelectorAll(".lane");
const scoreEl = document.getElementById("score");

let score = 0;
let interval;
let audio;

// START NIVEL
document.querySelectorAll(".level").forEach(level=>{
  level.onclick = ()=>{
    startLevel(
      level.dataset.music,
      Number(level.dataset.bpm)
    );
  };
});

function startLevel(music, bpm){
  menu.style.display="none";
  game.style.display="block";
  hud.style.display="block";
  score = 0;
  scoreEl.textContent = 0;

  if(audio) audio.pause();
  audio = new Audio(music);
  audio.play();

  const ms = 60000 / bpm;
  clearInterval(interval);
  interval = setInterval(spawnNote, ms);
}

function spawnNote(){
  const lane = lanes[Math.floor(Math.random()*4)];
  const note = document.createElement("div");
  note.className="note";
  note.style.top="-40px";
  lane.appendChild(note);

  let y = -40;
  function fall(){
    y += 5;
    note.style.top = y + "px";

    if(y > innerHeight){
      note.remove();
      return;
    }
    requestAnimationFrame(fall);
  }
  fall();
}

// CONTROLES WASD
document.addEventListener("keydown", e=>{
  const key = e.key.toLowerCase();

  lanes.forEach(lane=>{
    if(lane.dataset.key === key){
      const hitY = lane.querySelector(".hit").getBoundingClientRect().top;
      const notes = [...lane.querySelectorAll(".note")];

      notes.forEach(note=>{
        const noteY = note.getBoundingClientRect().top;
        const diff = Math.abs(noteY - hitY);

        if(diff < 40){
          note.remove();
          score += 100;
          scoreEl.textContent = score;
        }
      });
    }
  });
});
</script>

</body>
</html>
