<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analizador de Código</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #330a00, #662000);
      color: #ffd8a6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .container {
      background: rgba(60, 20, 0, 0.3);
      backdrop-filter: blur(6px);
      border: 2px solid #ff8c00;
      border-radius: 1rem;
      box-shadow: 0 0 20px #ff8c0055;
      padding: 2rem;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      color: #ff8c00;
      text-shadow: 0 0 10px #ff8c00aa;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      text-align: center;
      color: #ffb366;
      margin-bottom: 2rem;
      font-size: 1.1em;
    }

    .input-container {
      position: relative;
      margin-bottom: 2rem;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      padding: 15px;
      font-size: 1.1em;
      border: 2px solid #ff8c00;
      border-radius: 0.8rem;
      background: rgba(50, 10, 0, 0.3);
      color: #ffd8a6;
      outline: none;
      transition: 0.3s;
      font-family: 'Courier New', monospace;
    }

    textarea:focus {
      border-color: #ffb366;
      box-shadow: 0 0 10px #ff8c0077;
    }

    button {
      background: #ff8c00;
      color: #330a00;
      border: none;
      padding: 12px 30px;
      font-size: 1.1em;
      border-radius: 0.8rem;
      cursor: pointer;
      transition: 0.3s;
      display: block;
      margin: 20px auto 0;
      font-weight: 600;
      box-shadow: 0 0 10px #ff8c0055;
      text-transform: uppercase;
    }

    button:hover {
      background: #ffb366;
      transform: translateY(-2px);
      box-shadow: 0 0 20px #ff8c00;
    }

    .results {
      margin-top: 30px;
      background: rgba(60, 20, 0, 0.2);
      border: 1px solid #ff8c0033;
      border-radius: 0.8rem;
      padding: 1rem;
    }

    .result-card {
      background: rgba(50, 10, 0, 0.4);
      border: 2px solid #ff8c00;
      border-radius: 0.8rem;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 10px #ff8c0055;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #ff8c00;
      margin-bottom: 10px;
    }

    .result-content {
      color: #ffd8a6;
      line-height: 1.5;
    }

    .error-item {
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid #f44336;
      border-radius: 0.6rem;
      padding: 10px;
      margin-bottom: 8px;
      color: #ffb3b3;
    }

    .no-errors {
      color: #4caf50;
      font-weight: bold;
      text-align: center;
    }

    .language-tag {
      display: inline-block;
      background: #ff8c00;
      color: #330a00;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-right: 10px;
    }

    .confidence {
      font-size: 12px;
      color: #ffb366;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔍 Analizador de Código</h1>

    <div class="input-section">
      <div class="input-container">
        <textarea id="codeInput" placeholder="Pega tu código aquí para analizarlo..."></textarea>
      </div>
      <button onclick="analyzeCode()">Analizar Código</button>
    </div>

    <div id="results" class="results" style="display: none;">
      <div class="result-card language-card">
        <div class="result-title">Lenguaje de Programación</div>
        <div id="languageResult" class="result-content"></div>
      </div>

      <div class="result-card functionality-card">
        <div class="result-title">Funcionalidad Detectada</div>
        <div id="functionalityResult" class="result-content"></div>
      </div>

      <div class="result-card errors-card">
        <div class="result-title">Análisis de Errores</div>
        <div id="errorsResult" class="result-content"></div>
      </div>
    </div>
  </div>

  <script>
            function analyzeCode() {
            const code = document.getElementById('codeInput').value.trim();
            
            if (!code) {
                alert('Por favor, introduce algún código para analizar.');
                return;
            }

            const language = detectLanguage(code);
            const functionality = detectFunctionality(code);
            const errors = detectErrors(code, language);

            displayResults(language, functionality, errors);
        }

        function detectLanguage(code) {
            const patterns = {
                'JavaScript': {
                    patterns: [/function\s+\w+\s*\(/, /const\s+\w+\s*=/, /let\s+\w+\s*=/, /var\s+\w+\s*=/, /=>\s*{/, /console\.log\s*\(/, /document\./, /window\./, /addEventListener/],
                    weight: [3, 2, 2, 1, 3, 2, 3, 2, 2]
                },
                'Python': {
                    patterns: [/def\s+\w+\s*\(/, /import\s+\w+/, /from\s+\w+\s+import/, /print\s*\(/, /if\s+\w+.*:/, /for\s+\w+\s+in/, /class\s+\w+.*:/, /#.*/, /\bself\b/],
                    weight: [3, 2, 2, 2, 2, 2, 3, 1, 2]
                },
                'Java': {
                    patterns: [/public\s+class\s+\w+/, /public\s+static\s+void\s+main/, /System\.out\.println/, /private\s+\w+/, /public\s+\w+/, /import\s+java\./, /\/\*[\s\S]*?\*\//, /\/\/.*$/m],
                    weight: [4, 4, 3, 2, 2, 3, 1, 1]
                },
                'C++': {
                    patterns: [/#include\s*</, /int\s+main\s*\(/, /std::/, /cout\s*<</, /cin\s*>>/, /namespace\s+\w+/, /class\s+\w+\s*{/, /\/\/.*$/m],
                    weight: [3, 4, 3, 3, 3, 2, 3, 1]
                },
                'HTML': {
                    patterns: [/<html[^>]*>/, /<head[^>]*>/, /<body[^>]*>/, /<div[^>]*>/, /<p[^>]*>/, /<script[^>]*>/, /<style[^>]*>/, /<!DOCTYPE/i],
                    weight: [4, 3, 3, 2, 2, 2, 2, 3]
                },
                'CSS': {
                    patterns: [/\w+\s*{[^}]*}/, /\.\w+\s*{/, /#\w+\s*{/, /@media/, /background-color\s*:/, /margin\s*:/, /padding\s*:/, /font-size\s*:/],
                    weight: [3, 3, 3, 2, 2, 2, 2, 2]
                },
                'PHP': {
                    patterns: [/<\?php/, /\$\w+\s*=/, /echo\s+/, /function\s+\w+\s*\(/, /class\s+\w+/, /include\s+/, /require\s+/, /\?>$/],
                    weight: [4, 3, 2, 2, 3, 2, 2, 2]
                },
                'SQL': {
                    patterns: [/SELECT\s+.*\s+FROM/i, /INSERT\s+INTO/i, /UPDATE\s+.*\s+SET/i, /DELETE\s+FROM/i, /CREATE\s+TABLE/i, /ALTER\s+TABLE/i, /WHERE\s+/i, /JOIN\s+/i],
                    weight: [4, 3, 3, 3, 4, 3, 2, 2]
                }
            };

            let scores = {};
            
            for (let [lang, data] of Object.entries(patterns)) {
                scores[lang] = 0;
                data.patterns.forEach((pattern, index) => {
                    if (pattern.test(code)) {
                        scores[lang] += data.weight[index];
                    }
                });
            }

            const maxScore = Math.max(...Object.values(scores));
            const detectedLang = Object.keys(scores).find(key => scores[key] === maxScore);
            const confidence = Math.min(95, Math.max(30, (maxScore / 10) * 100));

            return { language: detectedLang || 'Desconocido', confidence: Math.round(confidence) };
        }

        function detectFunctionality(code) {
            const functionalities = [];

            // Detección de funcionalidades web
            if (/document\.|getElementById|querySelector|addEventListener|innerHTML|createElement/i.test(code)) {
                functionalities.push('Manipulación del DOM - Página Web Interactiva');
            }
            
            if (/<html|<head|<body|<div|<p|<h\d>/i.test(code)) {
                functionalities.push('Estructura HTML - Página Web');
            }

            if (/fetch\s*\(|XMLHttpRequest|axios|ajax/i.test(code)) {
                functionalities.push('Peticiones HTTP - Cliente Web/API');
            }

            // Discord bots
            if (/discord\.js|Discord|client\.on|message\.reply|bot\./i.test(code)) {
                functionalities.push('Bot de Discord');
            }

            // APIs y servidores
            if (/express|app\.get|app\.post|res\.send|app\.listen|router\./i.test(code)) {
                functionalities.push('Servidor Web/API REST');
            }

            if (/Flask|Django|@app\.route|render_template/i.test(code)) {
                functionalities.push('Aplicación Web (Backend Python)');
            }

            // Base de datos
            if (/SELECT|INSERT|UPDATE|DELETE|CREATE TABLE|mysql|mongodb|sqlite/i.test(code)) {
                functionalities.push('Gestión de Base de Datos');
            }

            // Juegos y gráficos
            if (/canvas|webgl|three\.js|game|player|enemy|score/i.test(code)) {
                functionalities.push('Juego/Aplicación Gráfica');
            }

            // Machine Learning
            if (/tensorflow|pytorch|sklearn|pandas|numpy|matplotlib/i.test(code)) {
                functionalities.push('Machine Learning/Análisis de Datos');
            }

            // Mobile
            if (/React Native|Flutter|ionic|cordova|android|ios/i.test(code)) {
                functionalities.push('Aplicación Móvil');
            }

            return functionalities.length > 0 ? functionalities : ['Funcionalidad general de programación'];
        }

        function detectErrors(code, languageInfo) {
            const errors = [];
            const language = languageInfo.language.toLowerCase();

            // Errores comunes de JavaScript
            if (language === 'javascript') {
                if (/console\.log\s*\([^)]*[^;]$/m.test(code)) {
                    errors.push('Posible falta de punto y coma después de console.log');
                }
                if (/function\s+\w+\s*\([^)]*\)\s*{[^}]*}[^;]/m.test(code)) {
                    errors.push('Las declaraciones de función no necesitan punto y coma al final');
                }
                if (/\bvar\b/.test(code)) {
                    errors.push('Considera usar "let" o "const" en lugar de "var"');
                }
            }

            // Errores comunes de Python
            if (language === 'python') {
                if (/^\s*if\s+.*[^:]$/m.test(code)) {
                    errors.push('Las declaraciones if en Python deben terminar con dos puntos (:)');
                }
                if (/print\s+[^(]/.test(code)) {
                    errors.push('En Python 3, print debe usarse como función: print()');
                }
            }

            // Errores comunes de HTML
            if (language === 'html') {
                if (!/<\/html>/i.test(code) && /<html/i.test(code)) {
                    errors.push('Etiqueta HTML de cierre </html> faltante');
                }
                if (!/<\/body>/i.test(code) && /<body/i.test(code)) {
                    errors.push('Etiqueta BODY de cierre </body> faltante');
                }
            }

            // Errores generales
            if (/\(\s*\)/.test(code) && /function|def|void/.test(code)) {
                // Paréntesis vacíos en funciones (no siempre es error)
            }

            // Detectar paréntesis desbalanceados
            const openParens = (code.match(/\(/g) || []).length;
            const closeParens = (code.match(/\)/g) || []).length;
            if (openParens !== closeParens) {
                errors.push(`Paréntesis desbalanceados: ${openParens} abren, ${closeParens} cierran`);
            }

            // Detectar llaves desbalanceadas
            const openBraces = (code.match(/{/g) || []).length;
            const closeBraces = (code.match(/}/g) || []).length;
            if (openBraces !== closeBraces) {
                errors.push(`Llaves desbalanceadas: ${openBraces} abren, ${closeBraces} cierran`);
            }

            return errors;
        }

        function displayResults(language, functionality, errors) {
            // Mostrar lenguaje
            document.getElementById('languageResult').innerHTML = `
                <span class="language-tag">${language.language}</span>
                <span class="confidence">Confianza: ${language.confidence}%</span>
            `;

            // Mostrar funcionalidad
            const funcList = functionality.map(func => `<li>• ${func}</li>`).join('');
            document.getElementById('functionalityResult').innerHTML = `<ul>${funcList}</ul>`;

            // Mostrar errores
            if (errors.length === 0) {
                document.getElementById('errorsResult').innerHTML = '<div class="no-errors">✅ No se detectaron errores obvios</div>';
            } else {
                const errorList = errors.map(error => `<div class="error-item">⚠️ ${error}</div>`).join('');
                document.getElementById('errorsResult').innerHTML = errorList;
            }

            // Mostrar resultados con animación
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
  </script>
</body>
</html>
