<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sobrevive a las Letras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      overflow: hidden;
      font-family: sans-serif;
    }

    canvas {
      display: block;
      background: linear-gradient(135deg, #222, #111);
    }

    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #0f0;
      font-size: 18px;
      z-index: 2;
    }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-template-rows: repeat(2, 60px);
      gap: 10px;
      z-index: 2;
    }

    .btn {
      background: #0f0;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 50%;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      touch-action: none;
    }

    .btn:active {
      background: #6f6;
    }

    .invisible {
      visibility: hidden;
    }

    #fireBtn {
      position: absolute;
      bottom: 100px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: #f90;
      border: none;
      border-radius: 50%;
      color: #000;
      font-size: 18px;
      font-weight: bold;
      z-index: 2;
      touch-action: none;
    }

    #fireBtn:active {
      background: #fc0;
    }
  </style>
</head>
<body>
  <div id="ui">‚ù§Ô∏è Vidas: <span id="vidas">3</span> | üïπÔ∏è Score: <span id="score">0</span></div>
  <canvas id="gameCanvas"></canvas>

  <div class="controls">
    <div class="invisible"></div>
    <button class="btn" id="btnUp">‚Üë</button>
    <div class="invisible"></div>
    <button class="btn" id="btnLeft">‚Üê</button>
    <button class="btn" id="btnDown">‚Üì</button>
    <button class="btn" id="btnRight">‚Üí</button>
  </div>

  <button id="fireBtn">FIRE</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    let player = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      r: 25,
      speed: 4,
      letra: "√ë",
      lastDir: { x: 0, y: -1 }
    };

    let keys = {};
    let touchKeys = { up: false, down: false, left: false, right: false };
    let enemigos = [];
    let balas = [];
    let vidas = 3;
    let score = 0;

    document.addEventListener("keydown", e => {
      const k = e.key.toLowerCase();
      keys[k] = true;
      if (k === " ") shoot();
    });

    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    // Botones m√≥viles
    function addTouchControl(id, dir) {
      const btn = document.getElementById(id);
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        touchKeys[dir] = true;
      });
      btn.addEventListener("touchend", (e) => {
        e.preventDefault();
        touchKeys[dir] = false;
      });
    }

    addTouchControl("btnUp", "up");
    addTouchControl("btnDown", "down");
    addTouchControl("btnLeft", "left");
    addTouchControl("btnRight", "right");

    document.getElementById("fireBtn").addEventListener("touchstart", (e) => {
      e.preventDefault();
      shoot();
    });

    function shoot() {
      const dir = player.lastDir;
      if (dir.x === 0 && dir.y === 0) return;

      balas.push({
        x: player.x,
        y: player.y,
        dx: dir.x * 8,
        dy: dir.y * 8,
        r: 5
      });
    }

    function spawnEnemigo() {
      const letras = "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ";
      const side = Math.floor(Math.random() * 4);
      let x, y;

      if (side === 0) { x = Math.random() * canvas.width; y = -30; }
      else if (side === 1) { x = canvas.width + 30; y = Math.random() * canvas.height; }
      else if (side === 2) { x = Math.random() * canvas.width; y = canvas.height + 30; }
      else { x = -30; y = Math.random() * canvas.height; }

      enemigos.push({
        x, y,
        r: 20,
        letra: letras[Math.floor(Math.random() * letras.length)]
      });
    }

    function update() {
      let dx = 0, dy = 0;

      if (keys["w"] || keys["arrowup"] || touchKeys.up) dy -= 1;
      if (keys["s"] || keys["arrowdown"] || touchKeys.down) dy += 1;
      if (keys["a"] || keys["arrowleft"] || touchKeys.left) dx -= 1;
      if (keys["d"] || keys["arrowright"] || touchKeys.right) dx += 1;

      if (dx !== 0 || dy !== 0) {
        const len = Math.hypot(dx, dy);
        player.x += (dx / len) * player.speed;
        player.y += (dy / len) * player.speed;
        player.lastDir = { x: dx / len, y: dy / len };
      }

      player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));
      player.y = Math.max(player.r, Math.min(canvas.height - player.r, player.y));

      enemigos.forEach((e, i) => {
        const distX = player.x - e.x;
        const distY = player.y - e.y;
        const dist = Math.hypot(distX, distY);

        e.x += (distX / dist) * 1.5;
        e.y += (distY / dist) * 1.5;

        if (dist < player.r + e.r) {
          enemigos.splice(i, 1);
          vidas--;
          document.getElementById("vidas").textContent = vidas;
          if (vidas <= 0) {
            alert("¬°Game Over! Score: " + score);
            location.reload();
          }
        }
      });

      // Balas
      balas.forEach((b, i) => {
        b.x += b.dx;
        b.y += b.dy;

        // Fuera de pantalla
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
          balas.splice(i, 1);
        } else {
          // Colisi√≥n con enemigos
          enemigos.forEach((e, j) => {
            const dist = Math.hypot(b.x - e.x, b.y - e.y);
            if (dist < b.r + e.r) {
              enemigos.splice(j, 1);
              balas.splice(i, 1);
              score += 10;
            }
          });
        }
      });

      score++;
      document.getElementById("score").textContent = score;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Jugador
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.r, 0, Math.PI * 2);
      ctx.fillStyle = "#0f0";
      ctx.fill();
      ctx.closePath();
      ctx.fillStyle = "#000";
      ctx.font = "bold 22px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(player.letra, player.x, player.y);

      // Enemigos
      enemigos.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
        ctx.fillStyle = "#f00";
        ctx.fill();
        ctx.closePath();
        ctx.fillStyle = "#fff";
        ctx.font = "bold 18px Arial";
        ctx.fillText(e.letra, e.x, e.y);
      });

      // Balas
      ctx.fillStyle = "#0ff";
      balas.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    setInterval(spawnEnemigo, 1000);
    gameLoop();
  </script>
</body>
</html>
