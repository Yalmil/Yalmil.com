<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Battle Royale de Letras</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      touch-action: none;
    }
    canvas {
      display: block;
      background: linear-gradient(to bottom right, #111, #333);
    }
    #selector {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }
    .letra-btn {
      padding: 10px 20px;
      margin: 5px;
      background-color: #222;
      border: 1px solid white;
      color: white;
      cursor: pointer;
    }
    .letra-btn:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
<div id="selector">
  <h1>Elige tu letra</h1>
  <div id="letras"></div>
</div>
<canvas id="juego"></canvas>

<script>
const canvas = document.getElementById("juego");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let keys = {};
let letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZÑ".split("");
let player, enemies = [], particles = [];
let spawnTime = 0;
let safeTime = 3000;
let selectedLetter = null;

let letraHabilidades = {
  "E": {speed: 5, desc: "Muy rápida"},
  "Z": {zigzag: true, desc: "Se mueve en zigzag"},
  "Ñ": {confuse: true, desc: "Invoca confusión"},
  "A": {shield: true, desc: "Tiene escudo inicial"},
  // Resto de letras con poderes neutrales
};

class Letter {
  constructor(x, y, char, color = "white", isPlayer = false) {
    this.x = x;
    this.y = y;
    this.char = char;
    this.color = color;
    this.isPlayer = isPlayer;
    this.radius = 20;
    this.speed = letraHabilidades[char]?.speed || 2;
    this.zigzag = letraHabilidades[char]?.zigzag || false;
    this.confuse = letraHabilidades[char]?.confuse || false;
    this.shield = true;
    this.dirX = 0;
    this.dirY = 0;
    this.target = null;
    this.spawnTime = Date.now();
  }

  move() {
    if (this.isPlayer) {
      let dx = 0, dy = 0;
      if (keys["ArrowUp"] || keys["w"]) dy = -1;
      if (keys["ArrowDown"] || keys["s"]) dy = 1;
      if (keys["ArrowLeft"] || keys["a"]) dx = -1;
      if (keys["ArrowRight"] || keys["d"]) dx = 1;
      this.x += dx * this.speed;
      this.y += dy * this.speed;
    } else {
      // IA
      if (!this.target || Math.random() < 0.01) {
        const pool = [...enemies, player].filter(l => l !== this);
        this.target = pool[Math.floor(Math.random() * pool.length)];
      }
      let angle = Math.atan2(this.target.y - this.y, this.target.x - this.x);
      if (this.zigzag) angle += Math.sin(Date.now() / 100) * 0.5;
      this.x += Math.cos(angle) * this.speed;
      this.y += Math.sin(angle) * this.speed;
    }
    // Limites
    this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
    this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
  }

  draw() {
    if (this.isPlayer && Date.now() - this.spawnTime < safeTime) {
      ctx.globalAlpha = 0.5;
    }
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(this.char, this.x, this.y);
    ctx.globalAlpha = 1;
  }

  checkCollision(other) {
    if (this === other || (this.isPlayer && Date.now() - this.spawnTime < safeTime)) return false;
    const dx = this.x - other.x;
    const dy = this.y - other.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    return dist < this.radius + other.radius;
  }
}

function initGame(char) {
  selectedLetter = char;
  document.getElementById("selector").style.display = "none";
  player = new Letter(canvas.width/2, canvas.height/2, char, "lime", true);
  enemies = [];
  for (let i = 0; i < 15; i++) {
    const eChar = letters[Math.floor(Math.random() * letters.length)];
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;
    enemies.push(new Letter(x, y, eChar, "red"));
  }
  animate();
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // Fondo cambiante
  canvas.style.background = `linear-gradient(to bottom right, hsl(${(Date.now()/50)%360}, 40%, 10%), black)`;

  player.move();
  player.draw();

  enemies.forEach(e => {
    e.move();
    e.draw();
    if (e.checkCollision(player)) {
      alert("¡Has perdido!");
      location.reload();
    }
  });

  requestAnimationFrame(animate);
}

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// Touch controls
let touchX = null, touchY = null;
canvas.addEventListener("touchstart", e => {
  const touch = e.touches[0];
  touchX = touch.clientX;
  touchY = touch.clientY;
});
canvas.addEventListener("touchmove", e => {
  const touch = e.touches[0];
  const dx = touch.clientX - touchX;
  const dy = touch.clientY - touchY;
  player.x += dx * 0.2;
  player.y += dy * 0.2;
  touchX = touch.clientX;
  touchY = touch.clientY;
});

// Selector de letras
const letrasDiv = document.getElementById("letras");
letters.forEach(char => {
  const btn = document.createElement("button");
  btn.className = "letra-btn";
  btn.innerText = `${char} (${letraHabilidades[char]?.desc || "Balanceado"})`;
  btn.onclick = () => initGame(char);
  letrasDiv.appendChild(btn);
});
</script>
</body>
</html>
