<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Battle Royale de Letras</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #111; color: #fff; font-family: sans-serif; }
    canvas { display: block; background: #222; }
    #ui {
      position: absolute; top: 10px; left: 10px; z-index: 10;
      background: rgba(0,0,0,0.7); padding: 10px; border-radius: 8px;
    }
    #selectScreen {
      position: absolute; width: 100%; height: 100%;
      display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
      background: #000; color: white; font-size: 24px;
    }
    .letterOption {
      margin: 8px; padding: 10px 20px;
      border: 2px solid white; cursor: pointer; border-radius: 5px;
      background: #333;
    }
    #joystick { position: absolute; bottom: 20px; left: 20px; width: 100px; height: 100px; border: 2px solid #fff; border-radius: 50%; touch-action: none; }
    #stick { position: absolute; width: 40px; height: 40px; background: white; border-radius: 50%; top: 30px; left: 30px; }
  </style>
</head>
<body>
<div id="selectScreen"></div>
<canvas id="gameCanvas"></canvas>
<div id="ui" style="display:none;">
  <div>Letra: <span id="letraNombre">?</span></div>
  <div>Vida: <span id="vidaBar">100</span></div>
</div>
<div id="joystick">
  <div id="stick"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = null;
let letrasIA = [];
let disparos = [];
let lastRespawn = 0;

const habilidades = {
  A: {color: '#f00', desc: 'Aumenta daño'},
  B: {color: '#0f0', desc: 'Regenera vida lentamente'},
  C: {color: '#00f', desc: 'Escudo temporal'},
  D: {color: '#fa0', desc: 'Dispara más rápido'},
  E: {color: '#0ff', desc: 'Velocidad extra'},
  F: {color: '#f0f', desc: 'Invisibilidad breve'},
  G: {color: '#ff0', desc: 'Área de empuje'},
  Ñ: {color: '#999', desc: 'Confusión enemiga'},
  Z: {color: '#ccc', desc: 'Ataque en zigzag'},
  // Añade más si quieres
};

function crearSeleccion() {
  const screen = document.getElementById('selectScreen');
  for (const letra in habilidades) {
    const div = document.createElement('div');
    div.className = 'letterOption';
    div.textContent = letra + ' - ' + habilidades[letra].desc;
    div.style.backgroundColor = habilidades[letra].color;
    div.onclick = () => iniciarJuego(letra);
    screen.appendChild(div);
  }
}

function iniciarJuego(letra) {
  document.getElementById('selectScreen').style.display = 'none';
  document.getElementById('ui').style.display = 'block';
  document.getElementById('letraNombre').textContent = letra;

  player = crearLetra(letra, true);
  for (let i = 0; i < 10; i++) {
    const rand = Object.keys(habilidades)[Math.floor(Math.random() * Object.keys(habilidades).length)];
    letrasIA.push(crearLetra(rand, false));
  }

  gameLoop();
}

function crearLetra(letra, esJugador) {
  const size = 40;
  return {
    letra,
    x: Math.random() * (canvas.width - size),
    y: Math.random() * (canvas.height - size),
    vx: 0,
    vy: 0,
    size,
    esJugador,
    vida: 100,
    inmune: true,
    tiempoInmune: 100,
    color: habilidades[letra].color,
    dispararCooldown: 0
  };
}

function moverLetra(letra) {
  if (letra.esJugador) {
    letra.x += letra.vx;
    letra.y += letra.vy;
  } else {
    const dx = player.x - letra.x;
    const dy = player.y - letra.y;
    const dist = Math.hypot(dx, dy);
    letra.vx = dx / dist * 1;
    letra.vy = dy / dist * 1;
    letra.x += letra.vx;
    letra.y += letra.vy;

    if (Math.random() < 0.01 && letra.dispararCooldown <= 0) {
      disparar(letra);
      letra.dispararCooldown = 60;
    }
  }

  if (letra.dispararCooldown > 0) letra.dispararCooldown--;
  if (letra.inmune) letra.tiempoInmune--;
  if (letra.tiempoInmune <= 0) letra.inmune = false;
}

function disparar(origen) {
  disparos.push({
    x: origen.x + origen.size / 2,
    y: origen.y + origen.size / 2,
    vx: origen.esJugador ? origen.vx * 3 : (Math.random() - 0.5) * 10,
    vy: origen.esJugador ? origen.vy * 3 : (Math.random() - 0.5) * 10,
    color: origen.color,
    origen
  });
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!player || player.vida <= 0) {
    if (Date.now() - lastRespawn > 2000) {
      player = crearLetra(player?.letra || 'A', true);
      lastRespawn = Date.now();
    }
    requestAnimationFrame(gameLoop);
    return;
  }

  moverLetra(player);
  letrasIA.forEach(m => moverLetra(m));

  // Dibujar jugador y enemigos
  function dibujarLetra(obj) {
    ctx.fillStyle = obj.inmune ? 'gray' : obj.color;
    ctx.beginPath();
    ctx.arc(obj.x, obj.y, obj.size / 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = "#000";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillText(obj.letra, obj.x, obj.y + 5);
  }

  dibujarLetra(player);
  letrasIA.forEach(m => dibujarLetra(m));

  // Vida
  document.getElementById('vidaBar').textContent = player.vida;

  // Dibujar disparos y colisiones
  disparos.forEach((bala, i) => {
    bala.x += bala.vx;
    bala.y += bala.vy;
    ctx.fillStyle = bala.color;
    ctx.beginPath();
    ctx.arc(bala.x, bala.y, 5, 0, Math.PI * 2);
    ctx.fill();

    [player, ...letrasIA].forEach(l => {
      if (bala.origen !== l && !l.inmune && Math.hypot(bala.x - l.x, bala.y - l.y) < l.size / 2) {
        l.vida -= 10;
        disparos.splice(i, 1);
      }
    });
  });

  letrasIA = letrasIA.filter(m => m.vida > 0);
  requestAnimationFrame(gameLoop);
}

crearSeleccion();

// Joystick móvil
let joystick = document.getElementById('joystick');
let stick = document.getElementById('stick');
let active = false;
joystick.addEventListener('touchstart', e => { active = true; }, false);
joystick.addEventListener('touchend', e => { active = false; player.vx = 0; player.vy = 0; }, false);
joystick.addEventListener('touchmove', e => {
  const rect = joystick.getBoundingClientRect();
  const touch = e.touches[0];
  const x = touch.clientX - rect.left - 50;
  const y = touch.clientY - rect.top - 50;
  player.vx = x / 50;
  player.vy = y / 50;
  stick.style.left = `${x + 50 - 20}px`;
  stick.style.top = `${y + 50 - 20}px`;
}, false);

// Controles PC
document.addEventListener('keydown', e => {
  if (!player) return;
  if (e.key === 'ArrowUp') player.vy = -3;
  if (e.key === 'ArrowDown') player.vy = 3;
  if (e.key === 'ArrowLeft') player.vx = -3;
  if (e.key === 'ArrowRight') player.vx = 3;
  if (e.key === ' ') disparar(player);
});
document.addEventListener('keyup', e => {
  if (['ArrowUp', 'ArrowDown'].includes(e.key)) player.vy = 0;
  if (['ArrowLeft', 'ArrowRight'].includes(e.key)) player.vx = 0;
});
</script>
</body>
</html>
