<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Battle Royale de Letras</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      background: #111;
      display: block;
    }
    #letterSelect {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }
    #letters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 90vw;
      gap: 10px;
    }
    .letter-btn {
      background: #444;
      color: white;
      border: none;
      padding: 10px;
      font-size: 24px;
      border-radius: 5px;
      cursor: pointer;
    }
    .letter-btn:hover {
      background: #666;
    }
    #desc {
      margin: 20px 0;
      text-align: center;
    }
    #joystick {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 100px;
      height: 100px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      touch-action: none;
    }
    #stick {
      width: 50px;
      height: 50px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 25px;
      left: 25px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="letterSelect">
    <h1>Elige tu letra</h1>
    <div id="letters"></div>
    <div id="desc"></div>
  </div>
  <canvas id="game"></canvas>
  <div id="joystick" style="display:none;">
    <div id="stick"></div>
  </div>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    let width = innerWidth, height = innerHeight;
    canvas.width = width;
    canvas.height = height;

    const joystick = document.getElementById("joystick");
    const stick = document.getElementById("stick");

    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZÑ".split("");
    const letterDesc = {
      E: "Velocidad aumentada",
      Z: "Ataques zigzag",
      Ñ: "Confunde enemigos cercanos",
      A: "Salto doble",
      B: "Escudo temporal",
      C: "Dash hacia adelante",
      D: "Disparo en línea recta",
      F: "Empuje de área",
      G: "Cura pequeña",
      H: "Invisible por segundos",
      I: "Veloz en línea recta",
      J: "Salta enemigos",
      K: "Ataca en curva",
      L: "Congela por 1s",
      M: "Multiplica sombra",
      N: "Copia aleatoria",
      O: "Explosión circular",
      P: "Ralentiza área",
      Q: "Atrapa a uno",
      R: "Rebote al impactar",
      S: "Ataque serpenteante",
      T: "Cae como trueno",
      U: "Salta paredes",
      V: "Absorbe disparos",
      W: "Dobla dirección",
      X: "Cruza enemigos",
      Y: "Vuela un instante",
      Ñ: "Confunde enemigos"
    };

    let player, enemies = [], keys = {}, immunity = 0;
    let joystickDir = {x: 0, y: 0};
    let selectedLetter = null;
    let bgColor = "#222";

    // Pantalla de selección
    const letterDiv = document.getElementById("letters");
    const descDiv = document.getElementById("desc");
    letters.forEach(l => {
      const btn = document.createElement("button");
      btn.className = "letter-btn";
      btn.innerText = l;
      btn.onclick = () => {
        selectedLetter = l;
        bgColor = `hsl(${Math.random()*360}, 50%, 15%)`;
        document.body.style.background = bgColor;
        document.getElementById("letterSelect").style.display = "none";
        joystick.style.display = "block";
        startGame();
      };
      btn.onmouseover = () => {
        descDiv.innerText = `${l}: ${letterDesc[l] || "Sin habilidad definida"}`;
      };
      letterDiv.appendChild(btn);
    });

    function startGame() {
      player = {x: width/2, y: height/2, size: 20, color: "white", letter: selectedLetter};
      immunity = 120;
      for (let i = 0; i < 20; i++) spawnEnemy();
      animate();
    }

    function spawnEnemy() {
      const enemyLetter = letters[Math.floor(Math.random() * letters.length)];
      const x = Math.random() * width;
      const y = Math.random() * height;
      enemies.push({x, y, size: 20, color: "red", letter: enemyLetter});
    }

    // Joystick (teléfono)
    let dragging = false;
    let baseX = 0, baseY = 0;
    joystick.addEventListener("touchstart", e => {
      dragging = true;
      baseX = e.touches[0].clientX;
      baseY = e.touches[0].clientY;
    });
    joystick.addEventListener("touchmove", e => {
      if (!dragging) return;
      const dx = e.touches[0].clientX - baseX;
      const dy = e.touches[0].clientY - baseY;
      const dist = Math.min(40, Math.sqrt(dx*dx + dy*dy));
      const angle = Math.atan2(dy, dx);
      stick.style.left = 25 + dist * Math.cos(angle) + "px";
      stick.style.top = 25 + dist * Math.sin(angle) + "px";
      joystickDir.x = Math.cos(angle);
      joystickDir.y = Math.sin(angle);
    });
    joystick.addEventListener("touchend", () => {
      dragging = false;
      stick.style.left = "25px";
      stick.style.top = "25px";
      joystickDir = {x: 0, y: 0};
    });

    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);

    function movePlayer() {
      let speed = 3;
      if (player.letter === "E") speed = 6;

      const dx = (keys["ArrowRight"] || keys["d"] ? 1 : 0) - (keys["ArrowLeft"] || keys["a"] ? 1 : 0) + joystickDir.x;
      const dy = (keys["ArrowDown"] || keys["s"] ? 1 : 0) - (keys["ArrowUp"] || keys["w"] ? 1 : 0) + joystickDir.y;

      player.x += dx * speed;
      player.y += dy * speed;

      player.x = Math.max(0, Math.min(width, player.x));
      player.y = Math.max(0, Math.min(height, player.y));
    }

    function drawPlayer() {
      ctx.fillStyle = immunity > 0 ? "cyan" : player.color;
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = "black";
      ctx.font = "16px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(player.letter, player.x, player.y + 5);
    }

    function updateEnemies() {
      enemies.forEach(enemy => {
        const dx = player.x - enemy.x;
        const dy = player.y - enemy.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist > 0) {
          enemy.x += (dx / dist) * 2;
          enemy.y += (dy / dist) * 2;
        }
        if (dist < player.size + enemy.size && immunity <= 0) {
          alert("¡Perdiste! Recarga la página.");
          location.reload();
        }
      });
    }

    function drawEnemies() {
      enemies.forEach(e => {
        ctx.fillStyle = e.color;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "white";
        ctx.font = "14px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(e.letter, e.x, e.y + 5);
      });
    }

    function animate() {
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, width, height);
      movePlayer();
      drawPlayer();
      updateEnemies();
      drawEnemies();
      if (immunity > 0) immunity--;
      requestAnimationFrame(animate);
    }
  </script>
</body>
</html>
